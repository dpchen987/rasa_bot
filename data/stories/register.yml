version: "3.1"

# 登记流程
stories:

# 登记加急处理
- story: register, base steps
  steps:
    - or:
      - intent: urge_to_send_goods
      - intent: specify_method_not_him_want_address
      - intent: consult_exception_reason
      - intent: cancel_to_send
      - intent: ask_code
      - intent: ask_damages
      - intent: reject_reason
      - intent: package_damage
      - intent: package_lack
      - intent: package_lost
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - checkpoint: register_ckp_1

- story: register, has phone number
  steps:
    - checkpoint: register_ckp_1
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_register_reply_6
    - action: action_session_start

- story: register, has no number
  steps:
    - checkpoint: register_ckp_1
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_ask_phone_appease    # 要电话，安抚
    - action: action_session_start


# 简单登记反馈
- story: register, base steps
  steps:
    - or:
      - intent: specify_method_himself
      - intent: specify_method_not_courier_station
      - intent: request_sent_to_delivery_cabinet
      - intent: request_to_contact_via_phone
      - intent: request_to_register
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - checkpoint: register_ckp_2

- story: register, has phone number
  steps:
    - checkpoint: register_ckp_2
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_register_has_signed_base    # 登记成功
    - action: utter_guide_to_end_has_workorder    # 结束前询问
    - action: action_set_slot_guide_to_end          # 对引导结束话术进行标记
    - action: action_session_start

- story: register, has no number
  steps:
    - checkpoint: register_ckp_2
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_ask_phone_base    # 要电话，反馈
    - action: action_session_start

# 已经联系过了、无法联系商家、要求联系
- story: has_contacted cannot_contact_seller unable_to_contact
  steps:
    - or:
        - intent: has_contacted
        - intent: cannot_contact_seller
        - intent: ask_to_contact
    - action: action_contact                # 判断上述三个意图所处的上下文环境
    - slot_was_set:
        - slot_unable_contact_key: 1
    - checkpoint: register_ckp_1

# 无法联系
- story: has_contacted cannot_contact_seller unable_to_contact
  steps:
    - intent: unable_to_contact
    - action: action_contact                # 判断上述意图所处的上下文环境
    - slot_was_set:
        - slot_unable_contact_key: 2
    - checkpoint: register_ckp_3

- story: register, has phone number
  steps:
    - checkpoint: register_ckp_3
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_register_reply_7
    - action: action_session_start

- story: register, has no number
  steps:
    - checkpoint: register_ckp_3
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_ask_phone_appease    # 要电话，安抚
    - action: action_session_start