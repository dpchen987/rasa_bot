version: "3.1"

stories:
# 寄送物品
- story: story_consult_send_item
  steps:
    - intent: consult_send_item
    - action: action_consult_send_item
    - action: action_session_start

# 查网点信息(地址和电话,已经签收，则发送派件网点信息)
- story: consult_station_info
  steps:
    - intent: consult_station_info
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_get_slot_core_intent_key
    - slot_was_set:
        - slot_core_intent_key: return
    - action: action_check_sign_status
    - slot_was_set:
        - slot_sign_status_key: hasSigned           # 已签收
    - action: action_consult_receive_station_info
    - action: action_session_start

# 查网点信息(地址和电话,未签收，则发送发件网点信息)
- story: consult_station_info
  steps:
    - intent: consult_station_info
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_get_slot_core_intent_key
    - slot_was_set:
        - slot_core_intent_key: return
    - action: action_check_sign_status
    - slot_was_set:
        - slot_sign_status_key: onTheWay            # 未签收
    - action: action_consult_send_station_info
    - action: utter_return_consult_station_info
    - action: action_session_start

# 查网点信息(地址和电话，默认情况，则发送派件网点信息)
- story: consult_station_info
  steps:
    - intent: consult_station_info
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_get_slot_core_intent_key
    - slot_was_set:
        - slot_core_intent_key: no_intent
    - action: action_consult_receive_station_info
    - action: action_session_start

# 查发件网点信息(地址和电话)
- story: consult_send_station_info
  steps:
    - intent: consult_send_station_info
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_consult_send_station_info
    - action: action_session_start

# 查驿站(自提点)信息(地址电话)
- story: story_consult_post_info
  steps:
    - intent: consult_post_info
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_consult_post_info
    - action: action_session_start

# 查件-查快递员电话
- story: story_consult_have_expressman_phone
  steps:
    - intent: consult_expressman_phone
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_consult_expressman_phone
    - action: action_session_start

## 查件-快递员电话流程(运单号填槽失败)
#- story: story_consult_expressman_phone
#  steps:
#    - intent: consult_expressman_phone
#    - action: collect_express_id_form
#    - active_loop: collect_express_id_form
#    - intent: intent_fill_slot_failure
#    - action: action_deactivate_loop
#    - active_loop: null
#    - action: action_consult_expressman_phone
#    - action: action_session_start

# 咨询发票（首次）
- story: story_consult_invoice
  steps:
    - intent: consult_invoice
    - action: action_intent_count
    - slot_was_set:
        - slot_consult_invoice_count_key: 1
    - action: utter_consult_invoice_1
    - action: utter_guide_to_end
    - action: action_set_slot_core_intent          # 对咨询发票意图进行标记
#    - action: action_set_slot_guide_to_end         # 对引导结束话术进行标记 ----- 这里不需要
    - action: action_session_start

# 咨询发票（第二次或多次要发票，有电话）
- story: story_consult_invoice
  steps:
    - intent: consult_invoice
    - action: action_intent_count
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_consult_invoice_count_key: 100
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_consult_invoice_2
    - action: utter_register_has_signed_base
    - action: utter_guide_to_end
    - action: action_set_slot_guide_to_end          # 对引导结束话术进行标记
    - action: action_session_start

# 咨询发票（第二次或多次要发票，且无电话）
- story: story_consult_invoice
  steps:
    - intent: consult_invoice
    - action: action_intent_count
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_consult_invoice_count_key: 100
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_consult_invoice_2
    - action: utter_ask_phone_base
    - action: action_session_start