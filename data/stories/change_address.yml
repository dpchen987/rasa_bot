version: "3.1"

stories:

# 地址是否更改成功
- story: change address or not
  steps:
    - intent: change_address_or_not
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_change_address_or_not
    - action: action_session_start

# version 2.0
#  用户只说「地址错了」，需要先澄清是用户写错地址了，还是快递发错地方了
- story: clarify which situation
  steps:
    - intent: address_is_wrong
    - action: utter_write_wrong_or_send_wrong_11
    - action: action_session_start

### 声明客服无法修改
- story: change address + has singed
  steps:
    - or:
      - intent: change_address
      - intent: write_wrong_address
      - intent: if_can_change_address
    - action: action_intent_count
    - slot_was_set:
        - slot_change_address_count_key: 1
    - action: action_slot_user_type_key
    - action: utter_change_address_reply_6       # 声明客服无法修改
    - action: action_confirm_set                 # 这里的confirm意图不需要登记，需要利用辅助词槽标记一下
    - action: action_set_slot_core_intent        # 对更址意图进行标记
    - action: action_session_start

# 表明发件人身份(在表达过更址意图之后)
- story: change_address + is_sender
  steps:
    - intent: is_sender
    - action: utter_get                           # 给出确认话术
    - action: action_get_slot_core_intent_key     # 获取更址意图标记槽位
    - slot_was_set:
        - slot_core_intent_key: change_address    # 表明此前用户已经表达过更址意图了
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_consult_send_station_info    # 给出发件网点信息
    - action: utter_change_address_reply_8        # 请客户联系上述网点
    - action: action_session_start

# 表明收件人身份(在表达过更址意图之后)
- story: change_address + is_receiver
  steps:
    - intent: is_receiver
    - action: action_get_slot_is_receiver_key
    - slot_was_set:
        - slot_is_receiver_key: change_address                 # 表明此前用户已经表达过更址意图了
    - action: utter_change_address_reply_6
    - action: action_session_start

# 发件人更址
- story: change_address 1
  steps:
    - or:
        - intent: change_address
        - intent: write_wrong_address
        - intent: if_can_change_address
    - action: action_intent_count
    - slot_was_set:
        - slot_change_address_count_key: 1
    - action: action_slot_user_type_key
    - slot_was_set:
        - slot_user_type_key: 发件人
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_consult_send_station_info        # 给出发件网点信息
    - action: utter_change_address_reply_8            # 请客户联系上述网点
    - action: action_session_start

- story: insist to change address
  steps:
    - or:
      - intent: has_contacted
      - intent: cannot_contact_seller
      - intent: ask_to_contact
      - intent: unable_to_contact
    - action: action_contact          # 根据slot_change_address_count，把流程意图与更址绑定
    - slot_was_set:
        - slot_change_address_count_key: 1
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_change_address_reply_7         # 声明不一定更址成功并引导联系商家
    - action: utter_register_has_signed_appease    # 登记完成话术
    - action: utter_guide_to_end_has_workorder     # 是否还有其他问题
    - action: action_set_slot_guide_to_end          # 对引导结束话术进行标记
    - action: action_session_start

- story: insist to change address
  steps:
    - or:
        - intent: has_contacted
        - intent: cannot_contact_seller
        - intent: ask_to_contact
        - intent: unable_to_contact
    - action: action_contact          # 根据slot_change_address_count，把流程意图与更址绑定
    - slot_was_set:
        - slot_change_address_count_key: 1
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_change_address_reply_7  # 声明不一定更址成功并引导联系商家
    - action: utter_ask_phone_appease       # 要电话
    - action: action_session_start

# 公共流程
- story: change_address base
  steps:
    - or:
        - intent: change_address
        - intent: write_wrong_address
        - intent: if_can_change_address
    - action: action_intent_count
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_change_address_count_key: 100
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_check_sign_status
    - checkpoint: change_address_ckp

### 已签收
- story: change address + has singed
  steps:
    - checkpoint: change_address_ckp
    - slot_was_set:
        - slot_sign_status_key: hasSigned        # 已签收
    - action: utter_change_address_reply_1       # 已签收安抚
    - action: action_confirm_set                 # 这里的confirm意图不需要登记，需要利用辅助词槽标记一下
    - action: action_session_start

# 运输途中，声明无法修改
- story: change address + on the way + statement
  steps:
    - checkpoint: change_address_ckp
    - slot_was_set:
        - slot_sign_status_key: onTheWay         # 运输途中
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_change_address_reply_5  # 声明不一定更址成功并引导联系商家
    - action: utter_register_has_signed_appease    # 登记完成话术
    - action: utter_guide_to_end_has_workorder    # 是否还有其他问题
    - action: action_set_slot_guide_to_end          # 对引导结束话术进行标记
    - action: action_session_start

- story: change address + on the way + statement
  steps:
    - checkpoint: change_address_ckp
    - slot_was_set:
        - slot_sign_status_key: onTheWay         # 运输途中
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_change_address_reply_5  # 声明不一定更址成功并引导联系商家
    - action: utter_ask_phone_appease    # 要电话
    - action: action_session_start

- story: insist to change address
  steps:
    - or:
        - intent: has_contacted
        - intent: cannot_contact_seller
        - intent: ask_to_contact
        - intent: unable_to_contact
    - action: action_contact          # 根据slot_change_address_count，把流程意图与更址绑定
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_change_address_count_key: 100
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_change_address_reply_7         # 声明不一定更址成功并引导联系商家
    - action: utter_register_has_signed_appease    # 登记完成话术
    - action: utter_guide_to_end_has_workorder     # 是否还有其他问题
    - action: action_set_slot_guide_to_end          # 对引导结束话术进行标记
    - action: action_session_start

- story: insist to change address
  steps:
    - or:
        - intent: has_contacted
        - intent: cannot_contact_seller
        - intent: ask_to_contact
        - intent: unable_to_contact
    - action: action_contact          # 根据slot_change_address_count，把流程意图与更址绑定
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_change_address_count_key: 100
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_change_address_reply_7  # 声明不一定更址成功并引导联系商家
    - action: utter_ask_phone_appease       # 要电话
    - action: action_session_start
