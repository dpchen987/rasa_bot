version: "3.1"

stories:
# 是否已拦截， 是否已退回
- story: return or not
  steps:
    - intent: return_or_not
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_return_or_not
    - action: action_session_start

### 声明无法退回(收件人)
- story: return + onTheWay + has phone
  steps:
    - intent: return
    - action: action_intent_count
    - slot_was_set:
        - slot_return_count_key: 1
    - action: action_slot_user_type_key
    - action: utter_return_reply_5                 # 声明无法退回
    - action: action_confirm_set                   # 这里的confirm意图不需要登记，需要利用辅助词槽标记一下
    - action: action_set_slot_core_intent         # 对退回意图进行标记
    - action: action_session_start

# 表明发件人身份(在表达过退回意图之后)
- story: return + is_sender
  steps:
    - intent: is_sender
    - action: action_get_slot_core_intent_key       # 获取退回意图标记槽位
    - slot_was_set:
        - slot_core_intent_key: return              # 表明此前用户已经表达过退回意图了
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_consult_send_station_info        # 给出发件网点信息
    - action: utter_return_reply_11                   # 请客户联系上述网点
    - action: action_session_start

# 表明收件人身份(在表达过退回意图之后)
- story: return + is_receiver
  steps:
    - intent: is_receiver
    - action: action_get_slot_is_receiver_key
    - slot_was_set:
        - slot_is_receiver_key: return                 # 表明此前用户已经表达过退回意图了
    - action: utter_return_reply_6
    - action: action_session_start

# 表明发件人身份(在表达退回或者更址意图之前，主要用于收集slot_user_type槽位信息)
- story: is_sender + return
  steps:
    - intent: is_sender
    - action: action_get_slot_core_intent_key
    - slot_was_set:
        - slot_core_intent_key: no_intent             # 表明此前用户没有表达过退回意图
    - action: action_session_start

# 发件人退货
- story: return 1
  steps:
    - intent: return
    - action: action_intent_count
    - slot_was_set:
        - slot_return_count_key: 1
    - action: action_slot_user_type_key
    - slot_was_set:
        - slot_user_type_key: 发件人
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_set_slot_core_intent
    - action: action_consult_send_station_info        # 给出发件网点信息
    - action: utter_return_reply_11                   # 请客户联系上述网点
    - action: action_session_start

- story: has contacted
  steps:
    - or:
        - intent: has_contacted
        - intent: cannot_contact_seller
        - intent: ask_to_contact
        - intent: unable_to_contact
    - action: action_contact          # 根据slot_return_count，把流程意图与更址绑定
    - slot_was_set:
        - slot_return_count_key: 1
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_return_reply_7    # 声明不一定可以退回成功 解释可能的退回过程
    - action: utter_register_has_signed_appease    # 登记完成话术
    - action: utter_guide_to_end_has_workorder    # 是否还有其他问题
    - action: action_set_slot_guide_to_end          # 对引导结束话术进行标记
    - action: action_session_start

- story: has contacted
  steps:
    - or:
        - intent: has_contacted
        - intent: cannot_contact_seller
        - intent: ask_to_contact
        - intent: unable_to_contact
    - action: action_contact          # 根据slot_return_count，把流程意图与更址绑定
    - slot_was_set:
        - slot_return_count_key: 1
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_return_reply_7    # 声明不一定可以退回成功 解释可能的退回过程
    - action: utter_ask_phone_appease    # 要电话
    - action: action_session_start


### 已签收
- story: return + hasSigned
  steps:
    - intent: return
    - action: action_intent_count
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_return_count_key: 100
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_check_sign_status
    - slot_was_set:
        - slot_sign_status_key: hasSigned    # 已签收
    - action: utter_return_reply_1         # 已签收安抚
    - action: action_confirm_set          # 这里的confirm意图不需要登记，需要利用辅助词槽标记一下
    - action: action_session_start

# 中转中
- story: insist to return
  steps:
    - intent: return
    - action: action_intent_count
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_return_count_key: 100
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_check_sign_status
    - slot_was_set:
        - slot_sign_status_key: onTheWay
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_return_reply_6    # 声明不一定可以退回成功 解释可能的退回过程
    - action: utter_register_has_signed_appease    # 登记完成话术
    - action: utter_guide_to_end_has_workorder    # 是否还有其他问题
    - action: action_set_slot_guide_to_end          # 对引导结束话术进行标记
    - action: action_session_start

- story: insist to return
  steps:
    - intent: return
    - action: action_intent_count
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_return_count_key: 100
    - action: collect_express_id_form
    - active_loop: collect_express_id_form
    - active_loop: null
    - action: action_check_sign_status
    - slot_was_set:
        - slot_sign_status_key: onTheWay
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_return_reply_6    # 声明不一定可以退回成功 解释可能的退回过程
    - action: utter_ask_phone_appease    # 要电话
    - action: action_session_start

# 联系过了
- story: insist to return
  steps:
    - or:
        - intent: has_contacted
        - intent: cannot_contact_seller
        - intent: ask_to_contact
        - intent: unable_to_contact
    - action: action_contact          # 根据slot_return_count，把流程意图与更址绑定
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_return_count_key: 100
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 1
    - action: utter_return_reply_7    # 声明不一定可以退回成功 解释可能的退回过程
    - action: utter_register_has_signed_appease    # 登记完成话术
    - action: utter_guide_to_end_has_workorder    # 是否还有其他问题
    - action: action_set_slot_guide_to_end          # 对引导结束话术进行标记
    - action: action_session_start

- story: insist to return
  steps:
    - or:
        - intent: has_contacted
        - intent: cannot_contact_seller
        - intent: ask_to_contact
        - intent: unable_to_contact
    - action: action_contact          # 根据slot_return_count，把流程意图与更址绑定
    # 此处的数字“100”并不是表示意图计数100次，而是表示大于“计数槽位最大值”的意思，假如“计数槽位最大值”为5，则大于等于6的数字都可以表示大于“计数槽位最大值”的意思，我们为了统一，指定了一个较大的数字100
    - slot_was_set:
        - slot_return_count_key: 100
    - action: action_set_slot_phone_key
    - slot_was_set:
        - slot_phone_key: 0
    - action: utter_return_reply_7    # 声明不一定可以退回成功 解释可能的退回过程
    - action: utter_ask_phone_appease    # 要电话
    - action: action_session_start
